<!DOCTYPE html>
<html lang="jp">
	<head>
		<meta charset="UTF-8" />
		<meta http-equiv="X-UA-Compatible" content="IE=edge" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<link rel="preconnect" href="https://fonts.googleapis.com" />
		<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
		<link
			href="https://fonts.googleapis.com/css2?family=Chango&family=Londrina+Shadow&display=swap"
			rel="stylesheet"
		/>
		<link rel="stylesheet" href="style.css" />

		<title>Dentaku</title>
	</head>
	<body class="font-Chango">
		<div class="container">
			<!-- main -->
			<div class="bg-chocolate-b text-chocolate-lb text-7xl">
				<!-- display -->
				<div class="btn justify-end">
					<p id="display" class="text-chocolate-lb text-3xl md:text-6xl"></p>
				</div>
				<!-- AC C -->
				<div class="flex">
					<div onclick="ac()" id="ac" class="btn justify-center">
						<p>AC</p>
					</div>
					<div onclick="c()" id="c" class="btn justify-center">
						<p>C</p>
					</div>
				</div>
				<!-- 7 8 9 ÷ -->
				<div class="flex">
					<div onclick="pushButton(7)" id="button" class="btn justify-center">
						<p>7</p>
					</div>
					<div onclick="pushButton(8)" id="button" class="btn justify-center">
						<p>8</p>
					</div>
					<div onclick="pushButton(9)" id="button" class="btn justify-center">
						<p>9</p>
					</div>
					<div onclick="pushButton('/')" id="button" class="btn justify-center">
						<p>÷</p>
					</div>
				</div>
				<!-- 4 5 6 × -->
				<div class="flex">
					<div onclick="pushButton(4)" id="button" class="btn justify-center">
						<p>4</p>
					</div>
					<div onclick="pushButton(5)" id="button" class="btn justify-center">
						<p>5</p>
					</div>
					<div onclick="pushButton(6)" id="button" class="btn justify-center">
						<p>6</p>
					</div>
					<div onclick="pushButton('*')" id="button" class="btn justify-center">
						<p>×</p>
					</div>
				</div>
				<!-- 1 2 3 - -->
				<div class="flex">
					<div onclick="pushButton(1)" id="button" class="btn justify-center">
						<p>1</p>
					</div>

					<div onclick="pushButton(2)" id="button" class="btn justify-center">
						<p>2</p>
					</div>
					<div onclick="pushButton(3)" id="button" class="btn justify-center">
						<p>3</p>
					</div>
					<div onclick="pushButton('-')" id="button" class="btn justify-center">
						<p>-</p>
					</div>
				</div>
				<!-- 0 = - -->
				<div class="flex">
					<div onclick="pushButton(0)" id="button" class="btn justify-center">
						<p>0</p>
					</div>
					<div onclick="pushButton('=')" id="button" class="btn justify-center">
						<p>=</p>
					</div>
					<div onclick="pushButton('+')" id="button" class="btn justify-center">
						<p>+</p>
					</div>
				</div>
			</div>
		</div>
		<script>
			/*
			やること：
			詳細：
			引数：
			返り値：
			*/
			var stackCol = [];
			let number = 0;
			let arit = "+";
			let status;
			var displayElm = document.getElementById("display");
			display(0);

			// try {
			// } catch (e) {
			// 	console.log(e);
			// }

			// 合計値を計算する
			// 数値と四則計算で使われる記号が交互に入った配列を受け取り、計算結果を返す
			// 引数 numAndParams[Number | String]
			// 返り値 Number
			function cal(numAndParams) {
				console.log(
					"call cal ---------------=============================>>>>>>>>>>>>>>>>>>>>>>"
				);
				let acc = 0;
				let param = "+";

				numAndParams.forEach((e) => {
					switch (e) {
						case "+":
						case "-":
						case "*":
						case "/":
							param = e;
							break;

						default:
							switch (param) {
								case "+":
									acc = acc + e;
									break;
								case "-":
									acc = acc - e;
									break;
								case "*":
									acc = acc * e;
									break;
								case "/":
									if (e === 0) {
										throw "Error: divided by zero";
									}
									acc = acc / e;
									break;
							}
							break;
					}
				});

				console.log("計算結果: " + acc);
				return acc;
				// let sort, divZ;

				// while (stackCol.length != 0) {
				// 	console.log("while");
				// 	sort = stackCol.slice(0, 0);//
				// 	console.log("sort : " + sort);
				// 	if (sort == "+" || sort == "-" || sort == "*" || sort == "/") {
				// 		console.log("if");
				// 		param = stackCol.shift();
				// 		console.log("param : " + param);
				// 	} else {

				// 		console.log("else");
				// 		switch (param) {
				// 			case "+":
				// 				acc = acc + stackCol.shift();

				// 				break;
				// 			case "-":
				// 				acc = acc + stackCol.shift();
				// 				break;
				// 			case "*":
				// 				acc = acc + stackCol.shift();
				// 				break;
				// 			case "/":
				// 				divZ = stackCol.shift();
				// 				if (divZ != 0) {
				// 					acc = acc + stackCol.shift();
				// 				} else {
				// 					console.log("error");
				// 				}
				// 				break;
				// 		}
				// 	}
				// }
				// console.log("stackCol : " + stackCol);
				// console.log("ANS :  " + acc);
			}

			/*
			やること：画面に文字、数字を表示する
			詳細：渡された引数の内容を、変数で指定された位置に表示する。
			引数：num : Number か String
			返り値：なし
			*/
			function display(num) {
				//画面表示
				console.log("here is display --------------------");
				displayElm.textContent = num;
			}

			/*
			やること：渡された引数を加工し、関数calに渡す。
			詳細：数値と四則計算で使われる記号が交互に入った配列を受け取り、それに記号と数値をプッシュし、その上で配列の中身が2個より多いなら配列を関数calに渡す。
			引数：proCol：配列、[Number | String]
				 number：変数、Number
				 arit：変数、String
			返り値：なし
			*/
			function provisional(proCol, number, arit) {
				console.log("here is provisional  --------------------");
				console.log("proCol:" + proCol);
				proCol.push(number, arit);
				let len = proCol.length;
				if (len > 2) {
					console.log("proCol:" + proCol);
					display(cal(proCol));
				}
			}

			/*
			やること：変数や配列を空にする（初期化する？）
			詳細：配列stackColを空に、変数arit number statusを0にする。
			引数：なし
			返り値：なし
			*/
			function ac() {
				console.log("function ac   ===============//////////////////////");
				//stackを0に
				stackCol = [];
				//arit,number,status,を0に
				arit = number = status = 0;
				//表示
				display(number);
				//
				logFour();
			}

			/*
			やること：現在ディスプレイに表示されている数を0にして、再入力できるようにする
			詳細：statusが1、2の時 -> 変数numberを0にし、表示する。statusを1にする。
				 statusがそれ以外の時 -> 関数acを呼び出し、statusを0にする。
			引数：なし
			返り値：なし
			*/
			function c() {
				//cボタンが押された時の処理
				switch (status) {
					case 1: // statusが1、2の時 ->現在の数*10＋入力された数 の現在の数を0にする。statusは1にする。
					case 2:
						number = 0;
						display(number);
						status = 1;
						break;

					default:
						// statusが3、errorの時 ->ac関数を呼び出す。statusは0にする。
						ac();
						status = 0;
						break;
				}
			}

			/*
			やること：ディスプレイにerrorと表示させ、状態をエラー状態（特定のボタン入力でしか画面が変わらない状態）にする。
			詳細：関数displayに"error"を渡す。statusを4にする。
			引数：なし
			返り値：なし
			*/
			function dividedByZero() {
				// 0で除算した時の処理
				console.log(
					"dividedByZero   ==================================================="
				);
				//エラーの文面を表示。
				display("error");

				// //[=]ボタンを非活性化
				// document.getElementById("button").disabled = false;
				// console.log("[=]ボタンを非活性化");
				// //[数字]ボタンを非活性化
				// document.getElementById("button").disabled = false;
				// console.log("[数字]ボタンを非活性化");
				//[+-*/]ボタンを非活性化
				// document.getElementById("button").disabled = false;
				// console.log("[+-*/]ボタンを非活性化");
				status = 4;
			}

			/*
			やること：1、入力されてきたものを正しく配列に収めて他関数に渡す。
					2、他関数からのエラーを受け取って、エラー状態へ遷移させる関数へ渡す。
			詳細：1、inButtonの中身を、配列stackColに、数字と四則計算記号（文字列）が交互になるように配列にプッシュして、配列を関数provisionalか、関数colに渡す。
				 2、provisionalか、関数colからエラーを受け取り、dividedByZeroを呼ぶ。
			引数：inButton：変数、Number か String
			返り値：なし。
			*/
			function pushButton(inButton) {
				console.log("inButton : " + inButton + "   ===============");
				//エラーのあれこれ

				switch (inButton) {
					case "+":
					case "-":
					case "*":
					case "/":
						console.log("here is status 2  --------------------");
						switch (status) {
							case 1:
							case 2:
								try {
									provisional(stackCol.concat(), number, arit);
								} catch (e) {
									// 0で除算した時の処理
									dividedByZero();
								}
								arit = inButton;
								logFour();
								status = 2;
								logFour();
								break;
							case 3:
								arit = inButton;
								logFour();
								status = 2;
								break;
							case 4:
								break;
						}
						break;
					case "=":
						console.log("here is status 3  --------------------");
						if (status == 3) {
							stackCol.push(arit);
						}
						stackCol.push(number);
						logFour();
						// number = 0;
						logFour();

						try {
							display(cal(stackCol));
						} catch (e) {
							// 0で除算した時の処理
							dividedByZero();
						}

						status = 3;

						logFour();
						break;

					// case 0:
					// case 1:
					// case 2:
					// case 3:
					// case 4:
					// case 5:
					// case 6:
					// case 7:
					// case 8:
					// case 9:
					default:
						switch (status) {
							case 2:
								console.log("here is status 1 case2 --------------------");

								stackCol.push(number, arit);
								number = inButton;
								display(number);
								logFour();
								break;
							case 3:
								console.log("here is status 1 case3 --------------------");

								// stackCol = [];
								ac();
								number = inButton;
								display(number);
								console.log("number :" + number);
								logFour();
								break;
							default:
								console.log("here is status 1 def --------------------");

								number = number * 10 + inButton;
								display(number);
								logFour();
								break;
						}
						logFour();
						status = 1;
						break;
				}
			}

			function logFour() {
				console.log("stackCol:" + stackCol);
				console.log("number:" + number);
				console.log("arit:" + arit);
				console.log("status:" + status);
				console.log(
					"--------------------------------------------" + "\n" + "\n"
				);
			}
		</script>
	</body>
</html>
