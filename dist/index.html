<!DOCTYPE html>
<html lang="jp">
	<head>
		<meta charset="UTF-8" />
		<meta http-equiv="X-UA-Compatible" content="IE=edge" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<link rel="preconnect" href="https://fonts.googleapis.com" />
		<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
		<link
			href="https://fonts.googleapis.com/css2?family=Chango&family=Londrina+Shadow&display=swap"
			rel="stylesheet"
		/>
		<link rel="stylesheet" href="style.css" />

		<title>Dentaku</title>
	</head>
	<body class="font-Chango">
		<div class="container">
			<!-- main -->
			<div class="bg-chocolate-b text-chocolate-lb text-7xl">
				<!-- display -->
				<div class="btn justify-end">
					<p id="display" class="text-chocolate-lb text-3xl md:text-6xl"></p>
				</div>
				<!-- AC C -->
				<div class="flex">
					<div onclick="ac()" id="ac" class="btn justify-center">
						<p>AC</p>
					</div>
					<div onclick="c()" id="c" class="btn justify-center">
						<p>C</p>
					</div>
				</div>
				<!-- 7 8 9 ÷ -->
				<div class="flex">
					<div onclick="pushButton(7)" id="button" class="btn justify-center">
						<p>7</p>
					</div>
					<div onclick="pushButton(8)" id="button" class="btn justify-center">
						<p>8</p>
					</div>
					<div onclick="pushButton(9)" id="button" class="btn justify-center">
						<p>9</p>
					</div>
					<div onclick="pushButton('/')" id="button" class="btn justify-center">
						<p>÷</p>
					</div>
				</div>
				<!-- 4 5 6 × -->
				<div class="flex">
					<div onclick="pushButton(4)" id="button" class="btn justify-center">
						<p>4</p>
					</div>
					<div onclick="pushButton(5)" id="button" class="btn justify-center">
						<p>5</p>
					</div>
					<div onclick="pushButton(6)" id="button" class="btn justify-center">
						<p>6</p>
					</div>
					<div onclick="pushButton('*')" id="button" class="btn justify-center">
						<p>×</p>
					</div>
				</div>
				<!-- 1 2 3 - -->
				<div class="flex">
					<div onclick="pushButton(1)" id="button" class="btn justify-center">
						<p>1</p>
					</div>

					<div onclick="pushButton(2)" id="button" class="btn justify-center">
						<p>2</p>
					</div>
					<div onclick="pushButton(3)" id="button" class="btn justify-center">
						<p>3</p>
					</div>
					<div onclick="pushButton('-')" id="button" class="btn justify-center">
						<p>-</p>
					</div>
				</div>
				<!-- 0 = - -->
				<div class="flex">
					<div onclick="pushButton(0)" id="button" class="btn justify-center">
						<p>0</p>
					</div>
					<div onclick="pushButton('=')" id="button" class="btn justify-center">
						<p>=</p>
					</div>
					<div onclick="pushButton('+')" id="button" class="btn justify-center">
						<p>+</p>
					</div>
				</div>
			</div>
		</div>
		<script>
			var stackCol = [];
			let number = 0;
			let arit;
			let status;
			var displayElm = document.getElementById("display");
			display(0);

			// try {
			// } catch (e) {
			// 	console.log(e);
			// }
			function cal(numAndParams) {
				console.log(
					"call cal ---------------=============================>>>>>>>>>>>>>>>>>>>>>>"
				);
				let acc = 0;
				let param = "+";

				numAndParams.forEach((e) => {
					switch (e) {
						case "+":
						case "-":
						case "*":
						case "/":
							param = e;
							break;

						default:
							switch (param) {
								case "+":
									acc = acc + e;
									break;
								case "-":
									acc = acc - e;
									break;
								case "*":
									acc = acc * e;
									break;
								case "/":
									if (e === 0) {
										throw "Error: divided by zero";
									}
									acc = acc / e;
									break;
							}
							break;
					}
				});

				console.log("計算結果: " + acc);
				return acc;
				// let sort, divZ;

				// while (stackCol.length != 0) {
				// 	console.log("while");
				// 	sort = stackCol.slice(0, 0);//
				// 	console.log("sort : " + sort);
				// 	if (sort == "+" || sort == "-" || sort == "*" || sort == "/") {
				// 		console.log("if");
				// 		param = stackCol.shift();
				// 		console.log("param : " + param);
				// 	} else {

				// 		console.log("else");
				// 		switch (param) {
				// 			case "+":
				// 				acc = acc + stackCol.shift();

				// 				break;
				// 			case "-":
				// 				acc = acc + stackCol.shift();
				// 				break;
				// 			case "*":
				// 				acc = acc + stackCol.shift();
				// 				break;
				// 			case "/":
				// 				divZ = stackCol.shift();
				// 				if (divZ != 0) {
				// 					acc = acc + stackCol.shift();
				// 				} else {
				// 					console.log("error");
				// 				}
				// 				break;
				// 		}
				// 	}
				// }
				// console.log("stackCol : " + stackCol);
				// console.log("ANS :  " + acc);
			}
			function display(num) {
				//画面表示
				console.log("here is display --------------------");
				displayElm.textContent = num;
			}

			function provisional(proCol, number, arit) {
				console.log("here is provisional  --------------------");
				console.log("proCol:" + proCol);
				proCol.push(number, arit);
				let len = proCol.length;
				if (len > 2) {
					console.log("proCol:" + proCol);
					display(cal(proCol));
				}
			}
			function ac() {
				console.log("function ac   ===============//////////////////////");
				//stackを0に
				stackCol = [];
				//arit,number,status,を0に
				arit = number = status = 0;
				//表示
				display(number);
				//
				console.log("stackCol:" + stackCol);
				console.log("number:" + number);
				console.log("arit:" + arit);
				console.log("status:" + status);
			}
			// 0で除算した時の処理
			function dividedByZero() {
				console.log(
					"dividedByZero   ==================================================="
				);
				//エラーの文面を表示。
				display("error");

				// //[=]ボタンを非活性化
				// document.getElementById("button").disabled = false;
				// console.log("[=]ボタンを非活性化");
				// //[数字]ボタンを非活性化
				// document.getElementById("button").disabled = false;
				// console.log("[数字]ボタンを非活性化");
				//[+-*/]ボタンを非活性化
				// document.getElementById("button").disabled = false;
				// console.log("[+-*/]ボタンを非活性化");
				status = 3;
			}

			function pushButton(inButton) {
				console.log("inButton : " + inButton + "   ===============");
				//エラーのあれこれ

				switch (inButton) {
					case "+":
					case "-":
					case "*":
					case "/":
						console.log("here is status 2  --------------------");
						switch (status) {
							case 1:
							case 2:
								try {
									provisional(stackCol.concat(), number, arit);
								} catch (e) {
									// 0で除算した時の処理
									dividedByZero();
								}
								arit = inButton;
								console.log("arit:" + arit);
								console.log("status:" + status);
								status = 2;
								logStack();
								break;
							default:
								break;
						}
						break;
					case "=":
						console.log("here is status 3  --------------------");
						stackCol.push(number);
						console.log("number :" + number);
						number = 0;
						logStack();

						if (status == 3) {
							stackCol.push(arit);
						}

						try {
							display(cal(stackCol));
						} catch (e) {
							// 0で除算した時の処理
							dividedByZero();
						}
						console.log("status:" + status);
						status = 3;
						console.log(
							"stackCol:" +
								stackCol +
								"   ===================================================="
						);
						break;

					// case 0:
					// case 1:
					// case 2:
					// case 3:
					// case 4:
					// case 5:
					// case 6:
					// case 7:
					// case 8:
					// case 9:
					default:
						switch (status) {
							case 2:
								console.log("here is status 1 case2 --------------------");
								console.log("def case2");

								stackCol.push(number, arit);
								number = inButton;
								display(number);
								logStack();
								break;
							case 3:
								console.log("here is status 1 case3 --------------------");
								// stackCol = [];
								ac();
								number = inButton;
								display(number);
								console.log("number :" + number);
								logStack();
								break;
							default:
								console.log("here is status 1 def --------------------");

								number = number * 10 + inButton;
								display(number);
								logStack();
								break;
						}
						console.log("status:" + status);
						status = 1;
						break;
				}
			}

			function logStack() {
				console.log("stackCol:" + stackCol);
			}
		</script>
	</body>
</html>
