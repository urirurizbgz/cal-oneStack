<!DOCTYPE html>
<html lang="jp">
	<head>
		<meta charset="UTF-8" />
		<meta http-equiv="X-UA-Compatible" content="IE=edge" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<link rel="preconnect" href="https://fonts.googleapis.com" />
		<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
		<link
			href="https://fonts.googleapis.com/css2?family=Chango&family=Londrina+Shadow&display=swap"
			rel="stylesheet"
		/>
		<link rel="stylesheet" href="style.css" />

		<title>Dentaku</title>
	</head>
	<body class="font-Chango">
		<div class="container">
			<!-- main -->
			<div class="bg-chocolate-b text-chocolate-lb text-7xl">
				<!-- display -->
				<div class="btn justify-end">
					<p id="display" class="text-chocolate-lb text-3xl md:text-6xl"></p>
				</div>
				<!-- AC C -->
				<div class="flex">
					<div onclick="ac()" id="ac" class="btn justify-center">
						<p>AC</p>
					</div>
					<div onclick="c()" id="c" class="btn justify-center">
						<p>C</p>
					</div>
				</div>
				<!-- 7 8 9 ÷ -->
				<div class="flex">
					<div onclick="pushValue(7)" id="button" class="btn justify-center">
						<p>7</p>
					</div>
					<div onclick="pushValue(8)" id="button" class="btn justify-center">
						<p>8</p>
					</div>
					<div onclick="pushValue(9)" id="button" class="btn justify-center">
						<p>9</p>
					</div>
					<div
						onclick="pushArithmetic('/')"
						id="button"
						class="btn justify-center"
					>
						<p>÷</p>
					</div>
				</div>
				<!-- 4 5 6 × -->
				<div class="flex">
					<div onclick="pushValue(4)" id="button" class="btn justify-center">
						<p>4</p>
					</div>
					<div onclick="pushValue(5)" id="button" class="btn justify-center">
						<p>5</p>
					</div>
					<div onclick="pushValue(6)" id="button" class="btn justify-center">
						<p>6</p>
					</div>
					<div
						onclick="pushArithmetic('*')"
						id="button"
						class="btn justify-center"
					>
						<p>×</p>
					</div>
				</div>
				<!-- 1 2 3 - -->
				<div class="flex">
					<div onclick="pushValue(1)" id="button" class="btn justify-center">
						<p>1</p>
					</div>

					<div onclick="pushValue(2)" id="button" class="btn justify-center">
						<p>2</p>
					</div>
					<div onclick="pushValue(3)" id="button" class="btn justify-center">
						<p>3</p>
					</div>
					<div
						onclick="pushArithmetic('-')"
						id="button"
						class="btn justify-center"
					>
						<p>-</p>
					</div>
				</div>
				<!-- 0 = - -->
				<div class="flex">
					<div onclick="pushValue(0)" id="button" class="btn justify-center">
						<p>0</p>
					</div>
					<div onclick="pushEqual()" id="button" class="btn justify-center">
						<p>=</p>
					</div>
					<div
						onclick="pushArithmetic('+')"
						id="button"
						class="btn justify-center"
					>
						<p>+</p>
					</div>
				</div>
			</div>
		</div>
		<script>
			/*
			やること：
			詳細：
			引数：
			返り値：
			*/
			var stackCol = [];
			let number = 0;
			let arit = "+";
			let status;
			var displayElm = document.getElementById("display");
			display(0);
			logFour();

			// テストを行うかどうかのフラグ
			const testing = true;

			if (testing) {
				test();
			}

			// try {
			// } catch (e) {
			// 	console.log(e);
			// }

			// 合計値を計算する
			// 数値と四則計算で使われる記号が交互に入った配列を受け取り、計算結果を返す
			// 引数 numAndParams[Number | String]
			// 返り値 Number
			function cal(numAndParams) {
				console.log(
					"call cal ---------------=============================>>>>>>>>>>>>>>>>>>>>>>"
				);
				let acc = 0;
				let param = "+";

				numAndParams.forEach((e) => {
					switch (e) {
						case "+":
						case "-":
						case "*":
						case "/":
							param = e;
							break;

						default:
							switch (param) {
								case "+":
									acc = acc + e;
									break;
								case "-":
									acc = acc - e;
									break;
								case "*":
									acc = acc * e;
									break;
								case "/":
									if (e === 0) {
										throw "Error: divided by zero";
									}
									acc = acc / e;
									break;
							}
							break;
					}
				});

				console.log("計算結果: " + acc);
				return acc;
				// let sort, divZ;

				// while (stackCol.length != 0) {
				// 	console.log("while");
				// 	sort = stackCol.slice(0, 0);//
				// 	console.log("sort : " + sort);
				// 	if (sort == "+" || sort == "-" || sort == "*" || sort == "/") {
				// 		console.log("if");
				// 		param = stackCol.shift();
				// 		console.log("param : " + param);
				// 	} else {

				// 		console.log("else");
				// 		switch (param) {
				// 			case "+":
				// 				acc = acc + stackCol.shift();

				// 				break;
				// 			case "-":
				// 				acc = acc + stackCol.shift();
				// 				break;
				// 			case "*":
				// 				acc = acc + stackCol.shift();
				// 				break;
				// 			case "/":
				// 				divZ = stackCol.shift();
				// 				if (divZ != 0) {
				// 					acc = acc + stackCol.shift();
				// 				} else {
				// 					console.log("error");
				// 				}
				// 				break;
				// 		}
				// 	}
				// }
				// console.log("stackCol : " + stackCol);
				// console.log("ANS :  " + acc);
			}

			/*
			やること：画面に文字、数字を表示する
			詳細：渡された引数の内容を、変数で指定された位置に表示する。
			引数：num : Number か String
			返り値：なし
			*/
			function display(num) {
				//画面表示
				console.log("display --------------------");
				displayElm.textContent = num;
			}

			/*
			やること：渡された引数を加工し、関数calに渡す。
			詳細：数値と四則計算で使われる記号が交互に入った配列を受け取り、それに記号と数値をプッシュし、その上で配列の中身が2個より多いなら配列を関数calに渡す。
			引数：proCol：配列、[Number | String]
				 number：変数、Number
				 arit：変数、String
			返り値：なし
			*/
			function provisional(proCol, number, arit) {
				console.log("provisional  --------------------");
				console.log("proCol:" + proCol);
				proCol.push(number, arit);
				let len = proCol.length;
				if (len > 2) {
					console.log("proCol:" + proCol);
					display(cal(proCol));
					return cal(proCol); //テスト用に追加
				}
			}

			/*
			やること：変数や配列を空にする（初期化する？）
			詳細：配列stackColを空に、変数arit number statusを0にする。
			引数：なし
			返り値：なし
			*/
			function ac() {
				console.log("function ac   ===============//////////////////////");
				//stackを0に
				stackCol = [];
				//arit,number,status,を0に
				arit = number = status = 0;
				//表示
				display(number);
				//logFour();
			}

			/*
			やること：現在ディスプレイに表示されている数を0にして、再入力できるようにする
			詳細：statusが1、2の時 -> 変数numberを0にし、表示する。statusを1にする。
				 statusがそれ以外の時 -> 関数acを呼び出し、statusを0にする。
			引数：なし
			返り値：なし
			*/
			function c() {
				console.log("function c   ===============//////////////////////");
				//cボタンが押された時の処理
				switch (status) {
					case 1: // statusが1、2の時 ->現在の数*10＋入力された数 の現在の数を0にする。statusは1にする。
					case 2:
						number = 0;
						display(number);
						status = 1;
						break;

					default:
						// statusが3、4（error）、0、その他、の時 ->ac関数を呼び出す。statusは0にする。
						ac();
						//status = 0; //要らなくね？
						break;
				}
			}

			/*
			やること：ディスプレイにerrorと表示させ、状態をエラー状態（特定のボタン入力でしか画面が変わらない状態）にする。そして状態を変える。
			詳細：関数displayに"error"を渡す。statusを4にする。
			引数：なし
			返り値：なし
			*/
			function dividedByZero() {
				// 0で除算した時の処理
				console.log(
					"dividedByZero   ==================================================="
				);
				//エラーの文面を表示。
				display("error");

				// //[=]ボタンを非活性化
				// document.getElementById("button").disabled = false;
				// console.log("[=]ボタンを非活性化");
				// //[数字]ボタンを非活性化
				// document.getElementById("button").disabled = false;
				// console.log("[数字]ボタンを非活性化");
				//[+-*/]ボタンを非活性化
				// document.getElementById("button").disabled = false;
				// console.log("[+-*/]ボタンを非活性化");
				status = 4;
				return status;
			}

			/*
			やること：渡された引数を一時的に保管し、仮計算を行い、関数calがエラーを投げたらdividedByZero関数を呼ぶ。そして状態を変える。
			詳細：
				statusが1、2の時 -> provisional関数にstackColの複製とnumber,arit,を渡す。もし関数calがエラーを投げたら、dividedByZero関数を呼び終了。aritにinButtonを、statusに2を代入。終了。
				statusが3の時 -> aritにinButtonを、statusに2を代入。終了。（status1、2と統合可能？）
				statusが4の時 ->何もしない（statusが4ではなく、デフォルトにすべきか？）
			引数：inButton: String
			返り値：なし
			*/
			function pushArithmetic(inButton) {
				console.log("here is status 2  --------------------");
				switch (status) {
					case 1:
					case 2:
						console.log("status 2 case 1,2");
						try {
							provisional(stackCol.concat(), number, arit);
						} catch (e) {
							// 0で除算した時の処理
							dividedByZero();
						}
						arit = inButton;
						status = 2;
						logFour();
						break;
					case 3:
						console.log("status 2 case 3");
						arit = inButton;
						status = 2;
						logFour();
						break;
					case 4:
						console.log("status 2 case 4");
						break;
				}
			}
			/*
			やること：配列と変数を加工し、関数calに渡す、関数calがエラーを投げたらdividedByZero関数を呼ぶ。そして状態を変える。
			詳細：statusが3の時stackColにaritとnumberをプッシュする、それ以外の時numberのみをプッシュする。
			そしてcal関数にstackCol渡し、その結果をdisplay関数に渡す。関数calがエラーを投げたらdividedByZero関数を呼び、終了。
			そしてstatusに3を代入し、終了。
			引数：なし
			返り値：なし
			*/
			function pushEqual() {
				console.log("here is status 3  --------------------");
				if (status == 3) {
					stackCol.push(arit);
				}
				stackCol.push(number);
				logFour();
				// number = 0;
				try {
					display(cal(stackCol));
				} catch (e) {
					// 0で除算した時の処理
					dividedByZero();
				}
				status = 3;

				logFour();
			}

			/*
			やること：渡された引数を加工し、正しいタイミングで記号とともに配列にプッシュする。
			詳細：
				statusが2の時 -> numberとarit関数をpush。numberにinButtonを代入した上でnumberをdisplay関数に渡す。statusに1を代入。
				statusが3の時 ->ac関数呼び出し。numberにinButtonを代入（status=2の時と統合可能？）statusに1を代入。
				statusがそれ以外の時 ->numberにnumber*10+inButtonを代入した上でnumberをdisplay関数に渡す。statusに1を代入。
			引数：inButton:Number
			返り値：なし
			*/
			function pushValue(inButton) {
				switch (status) {
					case 2:
						console.log("here is status 1 case2 --------------------");
						stackCol.push(number, arit);
						number = inButton;
						display(number);
						break;
					case 3:
						console.log("here is status 1 case3 --------------------");

						ac();
						number = inButton;
						display(number);
						break;
					default:
						console.log("here is status 1 def --------------------");

						number = number * 10 + inButton;
						display(number);
						break;
				}

				status = 1;
				logFour();
			}

			function test() {
				// cal()のテスト
				// 正常試験
				calTest([1, "+", 1], 2);
				calTest([512, "+", 340], 852);
				calTest([123, "-", 216], -93);
				calTest([31, "*", 6], 186);
				calTest([123, "/", 3], 41);

				// 異常試験
				calTest([123, "/", 0], false);
				calTest([123, "/", "+", 7], 130);
				// 境界試験
				calTest([-123, "+", 0], -123);
				calTest([-123, "*", -10], 1230);
				calTest([-123, "*", 10], -1230);
				calTest([123, "*", -10], -1230);

				// display()のテスト
				// 正常試験
				display(123456);
				display("error");
				display("123");

				// 異常試験
				//13桁以上表示（未）

				// 境界試験
				//小数点含む13桁表示（未）

				// provisional()のテスト provisionalTest(proCol, number, arit,req)
				// 正常試験
				provisionalTest([1, "+", 2], 3, "+", 6);
				provisionalTest([123, "-"], 216, "+", -93);
				provisionalTest([31, "*"], 6, "+", 186);
				provisionalTest([123, "/"], 3, "+", 41);
				// 異常試験
				provisionalTest([1, "/"], 0, "+", false);
				provisionalTest([123, "/", "+", 7], 10, "+", 140);
				// 境界試験
				provisionalTest([-123, "+"], 0, "+", -123);
				provisionalTest([-123, "*"], -10, "+", 1230);
				provisionalTest([-123, "*"], 10, "+", -1230);
				provisionalTest([123, "*"], -10, "+", -1230);

				// ac()のテスト
				// 正常試験
				acTest();

				// 異常試験 なし
				// 境界試験 なし

				// c()のテスト
				// 正常試験
				cTest(1);
				cTest(2);
				cTest(3);
				cTest(4);
				cTest(0);
				cTest();
				// 異常試験
				cTest(0.5);
				cTest(-1);
				cTest(5);

				// 境界試験

				// dividedByZero()のテスト
				// 正常試験
				dividedByZeroTest(1);
				dividedByZeroTest(2);
				dividedByZeroTest(3);
				dividedByZeroTest(4);
				dividedByZeroTest(0);
				dividedByZeroTest();
				// 異常試験
				dividedByZeroTest(0.5);
				dividedByZeroTest(-1);
				dividedByZeroTest(5);
				// 境界試験

				//pushArithmetic()のテスト
				// 正常試験
				// 異常試験
				// 境界試験
				//pushEqual()のテスト
				// 正常試験
				// 異常試験

				// 境界試験
				//pushValue()のテスト //pushValueTest(stackCol,statusNum,numberNum,aritStr,inButton)
				// 正常試験

				pushValueTest([123, "/"], 2, 5, "-", 9); //式が続く status=1,スタックにプッシュされる
				pushValueTest([123, "/"], 3, 5, "-", 9); //別計算へ status=1,スタックが空になる,aritが0になる。numberは9になる
				pushValueTest([123, "/"], 0, 5, "-", 9); //桁あがり status=1,スタック、aritは変わらず、numberが59になる。
				pushValueTest([123, "/"], 1, 5, "-", 9); //桁あがり status=1,スタック、aritは変わらず、numberが59になる。
				pushValueTest([123, "/"], 4, 5, "-", 9); //桁あがり status=1,スタック、aritは変わらず、numberが59になる。
				pushValueTest([123, "/"], 5, 5, "-", 9); //桁あがり status=1,スタック、aritは変わらず、numberが59になる。
				// 異常試験
				// 境界試験
			}

			function success(str) {
				console.log(str + " ◯◯◯◯◯◯◯◯◯◯");
			}

			function failed(str) {
				console.log(str + " ××××××××××××");
			}

			function calTest(stack, req) {
				console.log("====================================  calTest");
				console.log("期待値: " + req);
				let num;
				try {
					num = cal(stack);
				} catch (e) {
					if (req === false) {
						success("cal: " + stack.join() + " Catched " + e);
						return;
					} else {
						failed("cal: " + stack.join());
					}
				}
				if (num === req) {
					success("cal: " + stack.join() + "=" + num);
				} else {
					failed("cal: " + stack.join() + "=" + num);
				}
			}

			function provisionalTest(stack, number, arit, req) {
				console.log("====================================  provisionalTest");
				console.log("期待値: " + req);
				let num;
				try {
					num = provisional(stack, number, arit);
				} catch (e) {
					if (req === false) {
						success("cal: " + stack.join() + " Catched " + e);
						return;
					} else {
						failed("cal: " + stack.join());
					}
				}
				if (num === req) {
					success("cal: " + stack.join() + "=" + num);
				} else {
					failed("cal: " + stack.join() + "=" + num);
				}
			}

			function acTest() {
				console.log("====================================  acTest");
				stackCol = [123, "/", "+", 7];
				number = 10;
				arit = "+";
				status = 3;
				logFour();
				ac();
				logFour();
			}

			function cTest(num) {
				console.log("====================================  cTest");
				stackCol = [123, "/", 7];
				number = 10;
				arit = "+";
				status = num;
				logFour();
				c();
				logFour();
			}

			function dividedByZeroTest(previousStatus) {
				console.log("====================================  dividedByZeroTest");
				status = previousStatus;
				console.log("previousStatus:  " + previousStatus);
				let num = dividedByZero();
				console.log("期待値: " + 4);
				if (num === 4) {
					console.log;
					success("dividedByZero: status:" + num);
				} else {
					failed("dividedByZero: status:" + num);
				}
			}

			function pushValueTest(stack, statusNum, numberNum, aritStr, inButton) {
				console.log("====================================  pushValueTest");
				//要改善
				status = statusNum;
				arit = aritStr;
				number = numberNum;
				stackCol = stack;
				console.log("status :" + status);
				logFour();
				pushValue(inButton);
			}
			function logFour() {
				console.log("stackCol:" + stackCol);
				console.log("number:" + number);
				console.log("arit:" + arit);
				console.log("status:" + status);
				console.log(
					"--------------------------------------------" + "\n" + "\n"
				);
			}
		</script>
	</body>
</html>
